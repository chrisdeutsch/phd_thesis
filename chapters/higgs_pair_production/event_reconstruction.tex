\section{Object reconstruction and selection}
\label{sec:object_reconstruction}

The reconstruction and selection of physics objects (i.e.\ electrons,
muons, \tauhadvis, jets, $b$-tagged jets, missing transverse momentum)
proceeds by exploiting their signatures in the detector. The same
algorithms are used to reconstruct and identify these objects in
simulation and data recorded with the ATLAS detector. Differences
between the performance of object reconstruction and selection in
simulation and the observed data are accounted for by dedicated
calibration measurements of efficiencies, energy \& momentum scales
and resolutions. Uncertainties on these measurements are propagated to
the final results by performing variations of these properties in
simulation.

The following introduces the reconstruction and selection of physics
objects relevant to this analysis. A discussion of objects not
directly used in this analysis is omitted.


\subsection{Track reconstruction and primary vertex selection}

The trajectories of charged particles...

Charged particle tracks are reconstructed from their signature in the
inner tracking detectors of the ATLAS detector. They are a fundamental
input to other reconstruction and identification algorithms where they
are used at different levels of reconstruction quality.

Say a thing about track fitting?

The baseline selection for charged particle tracks requires
$\pT > \SI{400}{\MeV}$??? 500?  and $|\eta| < \num{2.5}$ in addition
to several requirements on the number of hits, the number of missing
hits (holes), and the number of hits shared between multiple tracks in
the silicon-based tracking detectors.

And impact parameter requirements.

The vertex with the largest $\sum \pT^2$ of associated tracks is
chosen as the primary vertex.

\cite{PERF-2015-08}


\subsection{Electrons}

Use likelihood-based electron identification algorithm with loose
working point.

\cite{EGAM-2018-01}



\todo[inline]{electrons: reco \& ID / isolation}


\subsection{Muons}

\todo[inline]{muons: reco \& ID / isolation}


\subsection{\tauhadvis}

\todo[inline]{taus: seeding; energy scale (LC \& BRT); track selection;
  acceptance; Tau-ID (jet \& e)}

\subsection{Anti-\tauhadvis}


\subsection{Jets}
\todo[inline]{Jet building from clusters; calibration; bad jet veto; JVT;
  b-tagging}

\todo[inline]{Particle flow}


\subsection{Missing Transverse Momentum}

The missing transverse momentum is denoted as \pTmiss with its
magnitude being \MET by convention.

\todo[inline]{\MET: negative vector sum of reconstructed objects; soft term}

\subsection{Short Object Selection}

Say that this is the pre-selection that take part in the OLR and
vetoes? Tighter requirements are applied at the event-selection stage.

\begin{description}

\item[Electrons] are required to have $\pT > \SI{7}{\GeV}$ and to be
  reconstructed within the acceptance of the tracking detectors
  $|\eta| < \num{2.47}$. Electrons in the transition region between
  the barrel and endcaps of the ATLAS detectors,
  $1.37 < |\eta| < 1.52$, are rejected. A likelihood-based
  discriminant is used for electron identification to reject electron
  candidates originating from jets and non-prompt electrons (e.g.\
  from photon conversions or decays of hadrons) by exploiting
  variables sensitive to the shower-shape, track quality, information
  about transition radiation emission in the TRT, and spatial and
  momentum matching between track and calorimeter
  cluster~\cite{EGAM-2018-01}. The loose electron identification
  working point is used corresponding to an average identification
  efficiency of about \SI{93}{\percent}~\cite{EGAM-2018-01}.

  % FCLoose
  % topoetcone20/pT < 0.2
  % ptvarcone20_TightTTVA_pt1000/pT < 0.15
  Electron candidates with high activity in the vicinity of the
  electron are rejected by making a loose requirement on both
  calorimeter- and track-based isolation variables
  ($E_{\text{T}}^\text{cone20} / \pT < 0.2$ and
  $p_{\text{T}}^{\text{varcone20}}/ \pT < 0.15$ as described in
  Ref.~\cite{EGAM-2018-01}). The electron selection efficiency of the
  isolation requirement exceeds \SI{95}{\percent} for electrons with
  $\pT > \SI{20}{\GeV}$, quickly approaching efficiencies close to
  \SI{100}{\percent} at larger transverse
  momenta~\cite{EGAM-2018-01}. This requirement is inverted as part of
  the \faketauhadvis background estimation in the \lephad channel to
  provide a control region enhanced in multi-jet events.

  % Energy calibration???

  % Post-selection:
  % Medium LH
  % pT > 18 GeV

\item[Muons] are required to have $\pT > \SI{7}{\GeV}$ and pass the
  loose identification working point. Muons passing the loose working
  point are a superset of medium muons which are defined according to
  Ref.~\cite{MUON-2018-03} as: muons passing either the
  \emph{combined} or \emph{inside-out combined} reconstruction in
  $|\eta| < 2.5$; muons passing either the \emph{muon-spectrometer
    extrapolated} or \emph{silicon-associated forward} reconstruction
  in $2.5 < |\eta| < 2.7$. Various requirements are set on the muon
  reconstruction quality and matching between ID and MS tracks which
  depend on the muon reconstruction type and detector region. The
  loose identification working point additionally allows for
  \emph{calorimeter-tagged} and \emph{segment-tagged} muons in
  $|\eta| < 0.1$, a region insufficiently covered by the MS, to
  improve the muon selection efficiency.

  Muons are required to pass a loose isolation working point based on
  an isolation requirement combining information on charged and
  neutral particle signatures using a particle flow approach
  ($p_{\text{T}}^{\text{varcone30}} + 0.4 \times
  E_{\text{T}}^{\text{neflow20}} < 0.16$~\cite{MUON-2018-03}). The
  isolation requirement is inverted to provide a control region for
  the \faketauhadvis estimation in the \lephad channel.

  % What happens with muons for the muon in jet correction?

  % isPflowLoose_VarRadIso
  % (ptvarcone30_TightTTVA_pt500 + 0.4 neflowisol20) / pT < 0.16

  % Post-selection
  % pT > 17 GeV
  % Medium muon + |\eta| < 2.5
  % Iso???

\item[\tauhadvis] are required to have $\pT > \SI{20}{\GeV}$ and
  $|\eta| < 2.5$, rejecting candidates reconstructed in the transition
  region between barrel and endcaps ($1.37 < |\eta| < 1.52$).

  Candidate \tauhadvis are required to have either 1 or 3 charged
  particle tracks identified according to a multivariate track
  classification algorithm as originating from a charged pion produced
  in the \taulepton decay. The combined electric charge of these
  tracks is required to be $\pm 1\,e$.

  A BDT-based electron veto algorithm is applied to 1-prong \tauhadvis
  candidates to reject candidates originating from the signature of an
  electron in the detector. The algorithm is \SI{95}{\percent}
  efficient in selecting \tauhadvis candidates matched to \tauhad
  decays.

  A loose \tauhadvis identification using the RNN algorithm
  (cf.~\Cref{sec:tauid}) that combines the information of high-level
  variables, with sequences of charged particle tracks and clusters
  that are associated to the \tauhadvis candidates. This working point
  is defined to yield a true \tauhadvis selection efficiency of
  \SI{85}{\percent} (\SI{75}{\percent}) in simulated
  $\gamma^* \to \tauhad\tauhad$ events for 1-prong (3-prong)
  \tauhadvis. The mean \faketauhadvis selection
  efficiency\footnote{The \faketauhadvis selection efficiency depends
    strongly on the transverse momentum of \tauhadvis candidates thus
    only a mean value is given.} of the loose working point is about
  \SI{5}{\percent} (\SI{1}{\percent}) for 1-prong (3-prong) \tauhadvis
  candidates from simulated multi-jet
  events~\cite{ATL-PHYS-PUB-2019-033}.

  The \tauhadvis energy calibration is performed by combining a
  calorimeter-based energy measurement with information from the tau
  particle flow algorithm~\cite{PERF-2014-06} in boosted regression
  trees.

\item[Anti-\tauhadvis] adhere to the same selection criteria as
  \tauhadvis except for the \tauhadvis identification requirement
  which is partially inverted. \tauhadvis candidates are considered to
  be anti-\tauhadvis if they do not pass the loose \tauhadvis
  identification working point but exceed a very loose selection on
  the \tauhadvis identification score of $\text{RNN score} > 0.01$,
  which corresponds to a true \tauhadvis selection efficiency of about
  \SI{99}{\percent} in simulated $\gamma^* \to \tauhad\tauhad$.

  All search channels use the presence of anti-\tauhadvis to define
  control regions that are used perform data-driven estimates of
  backgrounds containing \faketauhadvis using the fake factor method.


\item[Jets] are reconstructed using the anti-\kt
  algorithm~\cite{Cacciari:2008gp} with a radius parameter
  of~$R = 0.4$. The inputs to the jet algorithm are provided by a
  particle flow reconstruction algorithm, described in
  Refs.~\cite{PERF-2015-09,JETM-2018-05}, exploiting the superior
  momentum resolution of the tracking system for charged particles
  with low transverse momenta by replacing the calorimetric
  measurement of their energy with a tracking-based momentum
  measurement, necessitating the subtraction of energy deposits by
  charged particles in the calorimeter. The particle flow algorithm
  provides an improved jet energy and angular resolution as well as
  pile-up stability compared to jets constructed based on topological
  clusters in the calorimeters only~\cite{JETM-2018-05}.

  $|\pT| > \SI{20}{\GeV}$

  Tight JVT~\cite{PERF-2014-03} on central jets loose
  fJVT~\cite{PERF-2016-06-witherratum,ATL-PHYS-PUB-2019-026} on
  forward jets.

  Only central jets $|\eta| < 2.5$ are considered as signal jets.

\item[Missing transverse momentum]

\end{description}


\subsection{Overlap Removal}

% https://gitlab.cern.ch/atlas/athena/tree/21.2/PhysicsAnalysis/AnalysisCommon/AssociationUtils/
% Harmonization note: https://cds.cern.ch/record/1743654/files/ATL-COM-PHYS-2014-451.pdf

After the event is reconstructed a overlap-removal procedure is applied to
resolve ambiguities when a physical object is reconstructed as multiple
particles in the ATLAS detector. The angular distance $\dRy =
\sqrt{\Delta y^2 + \Delta \phi^2}$ is used to measure the overlap of two
reconstructed objects. \todo{Why rapidity instead of pseudorapidity?}

The following step-by-step procedure is used to resolve ambiguities in
the reconstructed objects:\todo{This would be nicer as a table}
\begin{itemize}
  % https://indico.cern.ch/event/807799/contributions/3362328/attachments/1818680/2973610/Presentation.pdf
  % https://indico.cern.ch/event/814156/contributions/3396841/attachments/1830226/2997072/Presentation.pdf
%\item jet - $\mu$: Reject jet if not \btagged, $N_\text{tracks} < 4$ and $\dRy
%  < 0.4$

% https://gitlab.cern.ch/atlas/athena/-/blob/21.2/PhysicsAnalysis/AnalysisCommon/AssociationUtils/Root/EleEleOverlapTool.cxx
\item $e_1$ - $e_2$: Reject $e_1$ if both electrons share the track and ${\pT}_1
  < {\pT}_2$

% https://gitlab.cern.ch/atlas/athena/-/blob/21.2/PhysicsAnalysis/AnalysisCommon/AssociationUtils/Root/TauLooseEleOverlapTool.cxx
\item \tauhadvis - $e$: Reject \tauhadvis if $\dRy < 0.2$ and $e$ passes \verb|DFCommonElectronsLHLoose|

% https://gitlab.cern.ch/atlas/athena/-/blob/21.2/PhysicsAnalysis/AnalysisCommon/AssociationUtils/Root/TauLooseMuOverlapTool.cxx
\item \tauhadvis - $\mu$: Reject \tauhadvis if $\dRy < 0.2$:\\
  Case 1 ($\tauhadvis \pT > \SI{50}{\GeV}$): $p_{\text{T}, \mu} > \SI{2}{\GeV}$
  and combined muon\\
  Case 2 ($\tauhadvis \pT \leq \SI{50}{\GeV}$): $p_{\text{T}, \mu} > \SI{2}{\GeV}$

% https://gitlab.cern.ch/atlas/athena/-/blob/21.2/PhysicsAnalysis/AnalysisCommon/AssociationUtils/Root/EleMuSharedTrkOverlapTool.cxx
\item $\mu$ - $e$: Reject $\mu$ if calo-muon and shared ID track
\item $e$ - $\mu$: Reject $e$ if shared ID track

% https://gitlab.cern.ch/atlas/athena/-/blob/21.2/PhysicsAnalysis/AnalysisCommon/AssociationUtils/Root/EleJetOverlapTool.cxx
\item jet - $e$: Reject jet if $\dRy < 0.2$, not \btagged or \btagged and
  ${\pT}_{e} > \SI{100}{\GeV}$
\item $e$ - jet: Reject $e$ if $\dRy < 0.4$

% https://gitlab.cern.ch/atlas/athena/-/blob/21.2/PhysicsAnalysis/AnalysisCommon/AssociationUtils/Root/MuJetOverlapTool.cxx
\item jet - $\mu$: Reject jet if not \btagged, $N_\text{track} < 3$ ($p_\text{T,
  track} > \SI{500}{\MeV}$), and $\dRy < 0.2$
\item $\mu$ - jet: Reject $\mu$ if $\dRy < 0.4$
\end{itemize}
Due to a bug in the PFlow jet reconstruction, an additional OLR step removing
prompt muons being reconstructed as fake jets is implemented in the official ASG
OLR tool.

\begin{table}[htbp]
  \centering

  \resizebox{\textwidth}{!}{%
    \input{tables/overlap_removal}
  }

  \caption{Overlap removal algorithm. In all cases $\dRy$ refers to
    the angular distance of }
\end{table}

Additionally, an analysis-specific overlap-removal procedure for \tauhadvis,
anti-\tauhadvis and jets is implemented:
\begin{itemize}
\item jet - \tauhadvis: Reject jet if $\dRy < 0.2$
\item anti-\tauhadvis - jet: Reject anti-\tauhad if jet is \btagged and $\dRy <
  0.2$
\item jet - anti-\tauhadvis: Reject jet  if $\dRy < 0.2$
\end{itemize}
This establishes the following priority: \tauhadvis > \btagged jet >
anti-\tauhadvis > un-tagged jet.

The priority, \btagged jet > \tauhadvis > anti-\tauhadvis > un-tagged jet, was
investigated as an alternative but found to reduce signal acceptance in the
2-tag region significantly due to limited \tauhad rejection of the DL1r \btag
algorithm at the \SI{77}{\percent} working point. With the alternative priority
the signal acceptance is reduced by about \SI{8}{\percent} (\SI{13}{\percent})
in $\tauhad\taulep$ ($\tauhad\tauhad$).

\todo[inline]{Is the above still up to date for PflowJets?}

\todo[inline]{Special treatment of lepton OLR for b-jet corrections}

\todo[inline]{Truth labelling of jets in simulation cf.\ VHbb evidence paper}

\todo[inline]{Truth labelling of fake taus in simulation}



\subsection{$b$-jet momentum corrections}
\label{sec:bjet_momentum_corrections}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../phd_thesis"
%%% End:
