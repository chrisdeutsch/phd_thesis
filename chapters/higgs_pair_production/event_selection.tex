\section{Event Selection}
\label{sec:event_selection}

The event selection focuses on selecting events consistent with
$\bbbar\lephad$ or $\bbbar\hadhad$ final states. The selection
criteria applied to events are kept as loose as possible\todo{It could
  be looser...} given the limitations imposed by the trigger
selection. Distinguishing between signal and background events based
on object- and event-level observables is not the primary goal of the
event selection but rather of a multivariate analysis that will be
introduced at a later stage (in \Cref{sec:multivariate_analysis}). In
addition, suitable control and validation regions are defined for the
purpose of estimating background processes or validating background
estimates using data recorded by the ATLAS detector.

Events considered for further analysis are required to fulfil basic
quality criteria independent of the analysis channel:
\begin{itemize}
  % GRL + basic checks

  % eventInfoIn->errorState(xAOD::EventInfo::EventFlagSubDet::Tile) == xAOD::EventInfo::Error
  % Problems in tile calorimeter (``tile corrupted events''')
  %
  % eventInfoIn->errorState(xAOD::EventInfo::EventFlagSubDet::LAr) == xAOD::EventInfo::Error
  % LAr noise bursts
  %
  % eventInfoIn->errorState(xAOD::EventInfo::EventFlagSubDet::SCT) == xAOD::EventInfo::Error
  % SCT corrupted events (``recovery period after single event upset''')
  %
  % eventInfoIn->isEventFlagBitSet(xAOD::EventInfo::Core,18
  % Event info missing after TTC restart
\item All events are required to fulfil the data quality criteria by
  the ATLAS collaboration~\cite{DAPR-2018-01} requiring stable beams
  at the LHC and a fully operational detector.

  % Has vertex
\item The event is required to have a primary vertex.

  % No fake jets
  % DFCommonJets_eventClean_LooseBad
\item Events containing one or more jets that are classified as originating
  from non-collision backgrounds or calorimeter noise according to a
  \emph{loose} jet cleaning~\cite{ATLAS-CONF-2015-029} working point are
  rejected.
\end{itemize}

The search is divided into several analysis channels given by the
decay mode of the \taulepton pair and the type of trigger that
selected the event. The \lephad channel targets semi-leptonic decay
modes using single-lepton triggers (SLT) and lepton-plus-\tauhadvis
triggers (LTT). Each trigger category defines a corresponding
sub-channel, which are referred to as the \lephad SLT and \lephad LTT
channels. The \hadhad channel selects events with two \tauhadvis using
single-\tauhadvis triggers (STT) and di-\tauhadvis triggers
(DTT). While different types of triggers are used in the \hadhad
channel, the statistical analysis performed at a later stage will not
distinguish between events selected by STT and DTT, thus the \hadhad
final state is treated as a single analysis channel. In some cases,
for example for the background estimation, it will be required to
distinguish between both trigger categories. Cases where this applies
will be indicated explicitly.

Orthogonality between the \lephad and \hadhad channels is ensured by
the electron, muon, and \tauhadvis selections. In the \hadhad channel,
events are required to have exactly two \tauhadvis, vetoing events
with electrons or muons passing loose identification. Events in the
\lephad channels are required to have exactly one \tauhadvis and
exactly one electron or muon passing their respective loose
identification working point. Additionally, electrons (muons) are
required to pass the tight (medium) identification working point to
reduce backgrounds from jets being misidentified as electrons (muons).

Electrons, muons, and \tauhadvis have to be geometrically matched to
their corresponding objects at the HLT according to the trigger that
selected the event. Trigger-dependent transverse momentum thresholds
are applied to electrons, muons, and \tauhadvis to ensure that
triggers operate close to their trigger-efficiency plateau. The
thresholds applied in events selected by STT or SLT increased with
increasing instantaneous luminosity of the LHC during Run~2. In
contrast, lower \pT-thresholds on electrons, muons, and \tauhadvis
remained constant for DTT and LTT, trigger-rates instead being limited
by requiring additional jets and specific event topologies at the L1
trigger. The inclusion of the \lephad LTT channel allows to select
events with electrons or muons with transverse momenta below the SLT
\pT-threshold by requiring an additional \tauhadvis at
trigger-level. Orthogonality between the \lephad SLT and LTT channel
is ensured by only considering events with lepton \pT below the SLT
\pT-threshold for the LTT channel.

An overview of the signal region event selection for all search
channels is given in \Cref{tab:event_selection}. A more detailed
description of the \hadhad channel trigger selection will be given in
\Cref{sec:hadhad_trigger_selection}. Further selections applied at
event-level to define signal and control region will be summarised in
\Cref{sec:sr_and_cr_selection}.

\begin{table}[htbp]
  \centering

  \caption{Summary of the signal region event selections for the
    \hadhad, \lephad SLT, and \lephad LTT channel. Trigger-dependent
    thresholds are applied to the transverse momentum of electrons,
    muons, and \tauhadvis. Where applicable, the range of these
    thresholds is listed.  Requirements on jets in the central region
    for the DTT or LTT category are trigger-dependent and thus not
    summarised in this table. For the \hadhad channel, the
    requirements resulting from the choice of triggers will be
    described in \Cref{sec:hadhad_trigger_selection}. Jets in the
    forward region are not used for event selection
    purposes. Requirements of the object selection introduced in
    \Cref{sec:object_reconstruction} are assumed to apply.}%
  \label{tab:event_selection}

  \resizebox{\textwidth}{!}{
    \input{tables/event_selection.tex}
  }
\end{table}

\todo[inline]{Cuts aiming to reduce backgrounds, e.g.\ $m_{\tau\tau} >
  \SI{60}{\GeV}$ to reduce DY}

\todo[inline]{SR selection (not really applicable -- maybe talk about PNN)??? Anti-Tau CR}

\todo[inline]{Observables used to reduce backgrounds: dRTauTau, dRBB, mtautau,
  mbb, mHH}

\subsection{Trigger selection in the \hadhad channel}%
\label{sec:trigger}%
\label{sec:hadhad_trigger_selection}

The triggers used to collect data for the \hadhad channel are
summarised in \Cref{tab:triggers_hadhad}. The choice of triggers
depends on the data-taking period and will be motivated in the
following.

As Run~2 of the LHC progressed, several improvements were made to the
HLT algorithms for \tauhadvis triggers. In total three different HLT
chains are used:
\begin{description}

\item[\texttt{medium1\_tracktwo}] This chain is the primary HLT chain
  for \tauhadvis triggers from
  2015--2017~\cite{ATL-DAQ-PUB-2016-001,ATL-DAQ-PUB-2017-001,ATL-DAQ-PUB-2018-002}. A
  brief summary, derived from Ref.~\cite{ATLAS-CONF-2017-061}, is
  given here.

  First, a purely calorimeter-based reconstruction of the \tauhadvis
  candidate is performed in the region of interest (ROI) provided by
  the L1 trigger. The topo-cluster algorithm is applied to cells of
  energy in the calorimeters, the resulting clusters calibrated using
  a scheme accounting for the different response of the calorimeter to
  $e^\pm$/$\gamma$ and hadrons. The energy of \tauhadvis candidates is
  determined from clusters in a core region ($\Delta R < 0.2$) around
  the barycentre of cluster energies in the ROI, subsequently applying
  a \tauhadvis-specific calibration which is a function of \tauhadvis
  candidate \pT, $\eta$, and pile-up conditions. HLT thresholds on the
  transverse momentum of \tauhadvis candidates are applied after these
  steps.

  Second, a two-stage tracking approach~\cite{TRIG-2016-01} using
  \emph{fast tracking}, instead of the ``offline reconstruction''-like
  \emph{precision tracking}, is employed. As a first stage, fast
  tracking is performed in a narrow region surrounding the \tauhadvis
  ROI centre but extended over the entire beamline. The \pT-leading
  track resulting from this procedure is used to narrow down the
  search space by only considering tracks within
  $|\Delta z| < \SI{10}{\milli\metre}$ of this track, thus allowing to
  widen the region surrounding the ROI centre for the second
  stage. The second stage of fast tracking is performed in the volume
  defined by the leading track from the first stage, subsequently
  defining the multiplicities of core ($\Delta R < 0.2$) and isolation
  tracks ($0.2 < \Delta R < 0.4$). After the two-stage tracking
  procedure, track multiplicity requirements are applied. A \tauhadvis
  at HLT must have one to three tracks in the core region and at most
  one track in the isolation region.

  As a final step, a \tauhadvis selection similar to the offline
  \tauhadvis selection is performed. The tracks resulting from the
  two-stage tracking are used as seeds for precision tracking. The
  precision tracks are used to calculate discriminating variables used
  for \tauid. Finally, a BDT-based \tauid algorithm, similar to its
  counterpart from the offline \tauhadvis reconstruction, is applied
  requiring \tauhadvis to pass a medium efficiency working
  point.\footnote{The working points of the trigger-level \tauid do
    not correspond to the efficiencies of the \tauid of the offline
    reconstruction. The medium working point at trigger-level applies
    less stringent selections than the loose working point of offline
    \tauid.}

\item[\texttt{medium1\_tracktwoEF}]
  % The precision tracks are also called EF tracks, while fast tracks
  % are called FTF tracks.
  This chain was introduced for data-taking in
  2018~\cite{ATL-DAQ-PUB-2019-001} and differs from the previous one
  by delaying the track multiplicity selections to a later stage of
  the HLT chain. Instead of counting tracks from the two-stage fast
  track finding, the track multiplicities are defined using precision
  tracks. This change circumvented a reduction in efficiency for
  3-prong \tauhadvis in high pile-up conditions due to the fast track
  finding being more susceptible to fake
  tracks~\cite{ATL-DAQ-PUB-2019-001}.

\item[\texttt{mediumRNN\_tracktwoMVA}] This chain started operation
  with period K during 2018 data-taking~\cite{ATL-DAQ-PUB-2019-001},
  corresponding to an integrated luminosity until the end of Run~2 of
  about \SI{37}{\per\femto\barn}. Several changes were implemented on
  top of the previous chain.

  First, the \tauhadvis energy calibrations as part of the
  calorimeter-based \tauhadvis reconstruction are replaced by
  multivariate methods, namely Boosted Regression Trees. Second, the
  trigger-level \tauid is replaced by a RNN-based identification
  algorithm, adopting the approach taken for offline \tauid, which
  offers improved rejection of \tauhadvis originating from quark- or
  gluon-jets at the HLT. The improved background rejection allows to
  relax the track multiplicity cuts from 1--3 precision tracks to 0--3
  precision tracks in the core region. Allowing \tauhadvis without
  associated precision tracks at the HLT recovers cases where the fast
  track finding, which seeds the precision tracking, does not find any
  tracks in the core region. After the offline event reconstruction a
  fraction of these cases can be correctly reconstructed, thus
  improving the selection efficiency of the trigger.
\end{description}

- Trigger chains: Brief explanation of changes?
  - Mention the use of a logical ``OR'' from 18 K

- STT \& DTT -> If selected by both precedence is given to STT triggers

- STT
  - Increasing thresholds as instantaneous luminosity increases
  - Offl. cut on \tauhadvis \pT exceeding the HLT threshold by 15 to 20 \si{\GeV} to ensure trigger is on efficiency plateau

- DTT
  - Di-tau triggers changed a lot during Run~2 data-taking to limit trigger-rates as the instantaneous luminosity increased
  - In 2015: No additional jets at L1 but still applying jet cut due to negligible integrated luminosity collected in 2015. Tau thresholds
  - In 2016: L1 requires at least one jet with high \ET, the requirement is $\ET > \SI{25}{\GeV}$ at L1 provided none of the \tauhadvis are already fulfil $\ET > \SI{25}{\GeV}$ at L1.
  - In 2017: Two new triggers are introduced to cope with the rates. 4J12 and L1Topo.
    - L1Topo uses the the L1 topological trigger to diambiguate between \tauhadvis and jet ROIs. An additional jet with $\ET > \SI{25}{\GeV}$ is required which cannot be fulfilled by the tau ROIs anymore. Thus the L1Topo applies a tighter selection than the non-L1Topo based triggers with J25\_2J20\_3J12. L1Topo also introduces a \dRtautau cut of 2.8 on \tauhadvis ROIs at L1.
    - 4J12 requires two additional jets with $\ET > \SI{12}{\GeV}$.

 Why use 4J12 and L1Topo in 2017--?
 - Mostly relevant is L1Topo for intermediate to high resonances masses and SM \HH
 - Signal acceptance at low \mHH is limited by the jet \pT cut and the \dRtautau requirement. The 4J12 trigger improves the signal acceptance at low \mHH.
 - 4J12 serves as a backup trigger

 Inefficiency due to the 4J12 eta requirement:
 - ???

 L1Topo firmware issues for three runs
 -> Use backup trigger


Trigger selection flow chart...
 What events are considered STT, what events are considered L1Topo / 4J12?

Some trigger efficiency plot would be nice???


\todo[inline]{Trigger matching requirements}

\todo[inline]{Say that we sometimes differentiate between STT and DTT
  categories but in the end all STT and DTT events are combined for
  the analysis.}

\todo[inline]{Introduce what is meant with ``online'' and
  ``offline''.}

In the \tauhad\tauhad channel, events are selected using single (STT) and di-\tauhad
triggers (DTT). The list of triggers used can be found in \cref{tab:triggers_hadhad}.

\begin{sidewaystable}[p]
  \centering

  \caption{List of single- and di-\tauhadvis triggers used in the
    \hadhad channel. The trigger naming conventions of the ATLAS
    collaboration are used and summarised in the following. The
    \pT-thresholds on \tauhadvis at the HLT are denoted by
    \texttt{tauX}, where \texttt{X} is the threshold in
    \si{\GeV}. Three different \tauhadvis HLT chains are used
    (\texttt{medium1\_tracktwo}, \texttt{medium1\_tracktwoEF},
    \texttt{mediumRNN\_tracktwoMVA}) that differ in \tauhadvis track
    finding and selection, \tauhadvis identification, and \tauhadvis
    momentum calibration. \ET and isolation requirements for
    \tauhadvis at the L1 trigger are denoted by
    \texttt{XTAUY}(\texttt{I}/\texttt{IM}) with \texttt{Y} referring
    to the \ET-threshold in \si{\GeV}, \texttt{I}/\texttt{IM} the
    isolation requirements, and \texttt{X} the number of \tauhadvis
    fulfilling these criteria. Jets at the L1 trigger are similarly
    denoted by \texttt{XJY}(\texttt{.0ETA23}), where \texttt{Y} refers
    to the jet \ET-threshold in \si{\GeV}, the suffix \texttt{.0ETA23}
    referring to a requirement of $|\eta| < 2.3$ on jets, and
    \texttt{X} the number of jets fulfilling these conditions. Unless
    a trigger is based on the L1 topological trigger
    system~\cite{TRIG-2019-02} (L1Topo), here chains using the
    \texttt{DR-TAU20ITAU12I-J25} seed, no disambiguation between
    objects at L1 is performed such that one \texttt{TAU20IM} also
    ensures at least one count of \texttt{TAU12IM}, \texttt{J20}, and
    \texttt{J12}. For chains based on L1Topo, disambiguation is
    performed and additionally \tauhadvis at L1 are required to fulfil
    $\Delta R(\tau_0^{\text{L1}}, \tau_1^{\text{L1}}) \leq 2.8$.
    Requirements on \tauhadvis and jets from offline event
    reconstruction (offline requirements) are imposed. These
    requirements are specified in terms of the leading or sub-leading
    \tauhadvis ($\tau_0$ or $\tau_1$) or the leading or sub-leading
    central jet ($\text{j}_0$ or $\text{j}_1$). For all events
    selected by DTT, \tauhadvis have to fulfil
    $\pT(\tau_0) > \SI{40}{\GeV}$ and $\pT(\tau_1) >
    \SI{30}{\GeV}$. The data-taking periods where triggers were used
    are given in the last column.}%
  \label{tab:triggers_hadhad}

  \resizebox{\textwidth}{!}{
    \input{tables/hadhad_triggers}
  }
\end{sidewaystable}


Priority is given to STT events if the reconstructed \tauhad fulfil the
\pT-threshold of the trigger (\SI{100}{\GeV} for \verb|tau80|, \SI{140}{\GeV}
for \verb|tau125| and \SI{180}{\GeV} for \verb|tau160|) and are geometrically
matched to the HLT object that fired the trigger.

If the event does not fulfil the STT criteria, then the DTT is checked. The
\pT-thresholds for \tauhadvis is \SI{40}{\GeV} (\SI{30}{\GeV}) for the leading
(subleading) \tauhadvis candidate.

For three runs (336506, 336548, 336567) during 2017 data taking, L1Topo-based
triggers were mistakenly disabled in the trigger firmware also affecting the
\verb|L1DR-TAU20ITAU12I-J25| trigger. As a backup the almost unprescaled
\verb|HLT_tau35_medium1_tracktwo_tau25_medium1_tracktwo| trigger was used.

In 2017 / 2018 two different di-\tauhad triggers with different L1 seeds are
used. The L1 seeds are \verb|L1TAU20IM_2TAU12IM_4J12| and
\verb|L1TAU20IM_2TAU12IM_4J12.0ETA23| (4J12) and \verb|L1DR-TAU20ITAU12I-J25|
(L1Topo) and differ in the requirements on \tauhadvis and additional jets.

The 4J12 trigger requires two\footnote{Two \tauhadvis already satisfy 2J12}
additional jets at L1 with $\ET > \SI{12}{\GeV}$. Additionally, in 2018 the jets
are required to be in $|\eta| < 2.3$. The L1Topo trigger uses the ATLAS
topological trigger introduced in 2017 to require a $\Delta R(\tauhad, \tauhad)
< 2.8$ on both \tauhad as well as one additional jet with $\ET > \SI{25}{\GeV}$
at L1.

Orthogonality (and being on plateau of the trigger turn-on) between the 4J12 and
L1Topo trigger channel is ensured by offline cuts discussed in
Section.%~\ref{subsec:selhh_hadhad}.

During TS1 new \tauhadvis triggers employing RNN-based \tauhad identification
and MVA-based energy calibration were deployed. Starting from Period K, the
recommendation is to use a logical OR between the old
(\verb|medium1_tracktwoEF|) and new triggers (\verb|mediumRNN_tracktwoMVA|).


\subsection{Signal and control region event selection}%
\label{sec:sr_and_cr_selection}



\subsection{Selection of $\pp \ra hh \ra \bbbar\tauhad\tauhad$ Events}
% TODO
\label{sec:reconstruction_of_higgs_candidates}


\subsubsection{Preselection}

Trigger selection follows \cref{sec:trigger}

\subsubsection{Signal Region}

The SR selection is as follows:
\begin{itemize}
\item Exactly two reconstructed \tauhadvis passing \textit{loose} identification
  (RNN)

\item Unit electric charge of \tauhadvis candidate with opposite sign as
  reconstructed from the tracks associated to the \tauhadvis candidates

\item Two or more jets

\item Exactly two \btagged jets with the \SI{77}{\percent} working point of the
  DL1r tagger

\item No reconstructed and identified electrons and muons in the event

\item Passing the trigger selection described in \cref{sec:trigger}

\item The \tauhadvis are geometrically matched to objects that fired either the
  STT or the DTT trigger.

\item \mMMC > \SI{60}{\GeV}

\item At least one \bjet with \pT > \SI{45}{\GeV} \todo{Can we drop this?}
\end{itemize}


Orthogonality between the L1Topo and the 4J12 DTT is ensured by offline cuts on
\tauhadvis and jet \pT:
\begin{itemize}
\item STT events: \tauhadvis are required to pass a trigger-dependent \pT
  threshold as described in \cref{sec:trigger}. STT events are prioritised over
  DTT events.

\item DTT events in 2015-2016: The leading jet is required to have \pT >
  \SI{80}{\GeV} due to the additional jet requirement (J25) at L1 in 2016. This
  ensures that the L1 trigger is close to its efficiency plateau, minimizing the
  impact of a mismatch in trigger efficiency in data / MC.

\item DTT events in 2017-2018: Are categorised into two categories depending on
  the triggers to be checked:\todo{Chris: need to check treatment of non-L1Topo
    trigger at the beginning of 2017}
  \begin{itemize}
  \item If leading and subleading jet $\pT > \SI{45}{\GeV}$: Event is considered a
    4J12 event. This cut ensures that the additional jet requirement at L1 (J12)
    is fulfilled.
  \item Else if leading jet $\pT > \SI{80}{\GeV}$ and $\dRtautau \leq 2.5$:
    Event is considered a L1Topo event. The jet \pT and \dRtautau cut ensure
    that the additional J25 and \dRtautau requirement at L1 are fulfilled.
  \end{itemize}
\end{itemize}


\begin{table}[htbp]
  \centering
  \missingfigure{Yield table for hadhad}
  \caption{Yield table in the \hadhad preselection region}
  \label{tab:hadhad_presel_yields}
\end{table}

\begin{figure}[htbp]
  \centering

  \missingfigure{Acceptance x Efficiency}

  \caption{Acceptance (times efficiency) of the resonant production of narrow scalar resonances.}
  \label{fig:signal_acceptance_resonant}
\end{figure}

\todo[inline]{There is a \SI{23}{\GeV} subleading \tauhadvis \pT cut at
  derivation level which will affect STT events.}

\todo[inline]{Acceptance times efficiency plot for resonant analysis.}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../phd_thesis"
%%% End:
