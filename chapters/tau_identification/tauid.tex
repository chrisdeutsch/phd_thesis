The main goal of the \tauhadvis reconstruction employed at the ATLAS
experiment is to reconstruct \tauhadvis candidates that originate from
hadronic decays of \tauleptons (\truetauhadvis) with high
efficiency. As a result of this approach, objects from sources other
than \tauhad are frequently reconstructed as \tauhadvis candidates
(\faketauhadvis). Tau identification aims to distinguish between
\tauhadvis candidates from \tauhad and other sources.

The primary source of \faketauhadvis are quark- or gluon-initiated
jets due to the purely hadronic and jet-like signature of \tauhadvis
at the ATLAS experiment. Electrons can be another, less abundant,
source of \faketauhadvis which have to be distinguished from
\truetauhadvis using a dedicated algorithm. In the following, the
former classification task is referred to as \tauid while the latter
is referred to as \emph{electron veto}. Consequently, this chapter is
concerned with classifying the origin of \tauhadvis candidates as
either originating from \tauhad or from quark- or gluon-initiated
jets.

A number of features can be exploited to distinguish between
\tauhadvis candidates originating from \tauhad and quark- or
gluon-initiated jets:
\begin{description}

\item[\taulepton mass] The \taulepton has a mass of
  \SI{1.777}{\GeV}~\cite{pdg2020} and is therefore sufficiently
  massive to decay hadronically while still having a small mass
  compared to the energy scales of processes studied at the ATLAS
  experiment.

  The \taulepton mass can be used directly as a feature by considering
  the invariant mass of the reconstructed secondary particles
  associated to a \tauhadvis candidate. Ignoring reconstruction
  effects, the invariant mass of the visible decay products of \tauhad
  is bounded by the \taulepton mass. This is not the case for
  \tauhadvis candidates originating from quark- or gluon-initiated
  jets which do not have a strict bound.

  The other features, described hereafter, are consequences of, or
  closely related to the mass of the \taulepton.

\item[Particle multiplicity] Hadronic decays of \tauleptons produce
  few (visible) daughter particles. Most decays produce one or three
  charged hadrons (most frequently $\pi^{\pm}$) and zero to two
  neutral pions.
  % Ellis, Stirling, Webber: 6.4 Quark and gluon jet differences
  In contrast, the average multiplicity of charged and neutral
  particles inside of jets originating from the fragmentation of
  partons produced in hard scattering interactions is large and
  increases with the momentum of the
  jet~\cite{Ellis:1996mzs,STDM-2015-12}. Therefore, requirements on
  (charged) particle multiplicties are effective at rejecting
  \tauhadvis candidates originating from quark- or gluon-initiated
  jets.\footnote{Gluon-initiated jets have, on average, a larger
    particle multiplicity and a broader angular distribution of
    particles compared to quark-initiated jets due to the larger
    effective colour charge of
    gluons~\cite{Ellis:1996mzs}. Consequently, quark-initiated jets
    are more likely to be reconstructed and mis-identified as
    \tauhadvis candidates.}

\item[Collimated daughter particles] Analyses typically consider
  \tauhadvis candidates with transverse momenta exceeding
  \SI{20}{\GeV}. At these momentum scales the decay products of
  \tauleptons are collimated due to the Lorentz boost of the lepton,
  leading to the characteristic signature of a narrow jet with few
  visible particles. Requirements on the isolation of \tauhadvis
  candidates allow to reject candidates originating from quark- or
  gluon-initiated jets which have wider angular distribution of
  hadrons.

  % Mean flight path of a p = 20 GeV tau is
  % L = beta * gamma * c * tau = p/m0 * 87mu ~ 1mm
\item[\taulepton lifetime] The \taulepton has a proper lifetime of
  \SI{2.9e-13}{\second}
  ($c \tau = \SI{87}{\micro\metre}$)~\cite{pdg2020} and can thus
  travel for a few millimetres before decaying. The macroscopic
  distance traversed by the \taulepton before decaying produces a
  decay vertex that is displaced from the primary vertex (PV) of the
  hard interaction. For \taulepton decay modes with three charged
  hadrons, this secondary vertex can be reconstructed to determine its
  displacement from the PV. The secondary vertex cannot be
  reconstructed for decay modes with only one charged hadron. However,
  the longitudinal and transverse impact parameters of the track of
  the charged hadron can be used to gauge to incompatibility of the
  track with the PV, thus being sensitive to displaced decays of
  \tauleptons.

  Features related to the lifetime of the \taulepton can be used to
  distingush them from \tauhadvis candidates from quarks- or
  gluon-initiated jets as the hadrons constituting a jet are produced
  promptly at the PV of the interaction.
\end{description}
Prior to the method introduced in this chapter, the ATLAS
collaboration used BDTs as binary classifiers using high-level
discriminating variables as inputs to perform \tauid.

This chapter introduces a novel method of performing \tauid using
neural networks that combines the information of high-level
discriminating variables with information from sequences of
reconstructed charged-particle tracks and sequences of topological
clusters in the calorimeters associated to \tauhadvis candidates. A
characteristic feature of this method is the use of a recurrent neural
network (RNN) architecture which enables the processing of sequences
of arbitrary length such....

The method described in this chapter was initially proposed in
Ref.~\cite{cdeutsch-master} and subsequently implemented in the
software suite used by the ATLAS
collaboration~\cite{ATL-SOFT-PUB-2021-001}. The results of this work
are also published in Ref.~\cite{ATL-PHYS-PUB-2019-033} by the ATLAS
collaboration. The method was adopted by the ATLAS collaboration as
the recommended \tauid algorithm for analysis using the
\SI{139}{\per\femto\barn} $pp$-collision dataset recorded with the
ATLAS detector during Run~2 of the LHC.

This chapter is structured as follows. First,

\Cref{sec:tauid_mc}

\Cref{sec:tauid_rnn}

\Cref{sec:tauid_perf}

\Cref{sec:tauid_conclusion}


\section{Simulated Event Samples}%
\label{sec:tauid_mc}

The tau reconstruction and identification algorithms employed at the
ATLAS experiment for Run~2 of the LHC were developed using simulated
events that provide samples of \tauhadvis candidates. For the \tauid
algorithms, simulated $\gammastar \to \tautau$ and di-jet events are
used to yield samples of true- and \faketauhadvis, respectively.

% y->tautau:
% https://gitlab.cern.ch/atlas-physics/pmg/infrastructure/mc15joboptions/-/blob/master/share/DSID425xxx/MC15.425200.Pythia8EvtGen_A14NNPDF23LO_Gammatautau_MassWeight.py
An artifical $\gammastar \to \tautau$ event sample was generated using
\PYTHIA[8.212]~\cite{Sjostrand:2014zea} for the matrix element
calculation at leading order and parton showering. The contribution of
the $Z$ boson propagator to the hard scattering process was disabled
to provide an unpolarised sample of \tauleptons. In addition, the
cross-section of the process was modified at generator-level to
enhance the number of events with high invariant $\tautau$ masses to
increase the number of \tauhadvis candidates with high transverse
momenta. Finally, both \tauleptons are enforced to decay hadronically
to maximise statistical precision of the \truetauhadvis sample for
\tauid developments.

% Di-jet samples: JZ1W up to JZ6W
% https://gitlab.cern.ch/atlas-physics/pmg/infrastructure/mc15joboptions/-/blob/master/share/DSID361xxx/MC15.361021.Pythia8EvtGen_A14NNPDF23LO_jetjet_JZ1W.py

Decays of hadrons containing $b$- or $c$-quarks are simulated using
\EVTGEN[v1.2.0]. Both samples use the A14 set of tuned parameters for
\PYTHIA[8]~\cite{ATL-PHYS-PUB-2014-021} and the
\NNPDF[2.3lo]~\cite{Ball:2012cx} set of parton distribution functions.


The studies presented in this chapter

Training setup, i.e.\ samples (dijet \& $\gamma^*$)

Use as source of \tauhadvis candidates.

Tauhad Truth matching???

Reweighting of (fake) \tauhad \pT

Biased phase space sampling to artificially enhance the events with
high $m_{\tau\tau}$ yielding high momentum taus.

Cuts applied to \tauhadvis candidates.


\section{Tau Identification with Recurrent Neural Networks}
\label{sec:tauid_rnn}

\todo[inline]{Motivated by RNNIP: \cite{ATL-PHYS-PUB-2017-003}}

\subsection{Input Variables}

\begin{table}[htbp]
  \centering

  \caption{Input variables. Adopted from
    Ref.~\cite{ATL-PHYS-PUB-2019-033}.}%
  \label{tab:tauid_input_variables}

  \input{tables/tauid_inputs}
\end{table}

Plots of high-level variables

Plots of (some) low-level variables???


\subsection{Network Architecture}

\begin{figure}[htbp]
  \centering

  \includegraphics[width=0.95\textwidth]{tauid/pubnote/rnn_network_architecture}

  \caption{Network Architecture of the RNN \tauhad-identification
    algorithm \cite{ATL-PHYS-PUB-2019-033}}
  \label{fig:tauid_network_architecture}
\end{figure}

\subsection{Training and evaluation}

Keras Tensorflow lwtnn \cite{lwtnn,keras,tensorflow2015-whitepaper,lstm}

Used in the software suite
\textsc{Athena}~\cite{ATL-SOFT-PUB-2021-001}.

\subsection{Working Point Definition}


\subsection{Calibration}


\section{Tau Identification Performance}
\label{sec:tauid_perf}

\begin{figure}[htbp]
  \centering

  \includegraphics[width=0.6\textwidth]{tauid/pubnote/rnn_bdt_roc}

  \caption{Receiver operating characteristic of the RNN
    \tauhad-identification algorithm \cite{ATL-PHYS-PUB-2019-033}}
  \label{fig:tauid_rnn_bdt_roc_comparison}
\end{figure}


\begin{table}
  \centering

  \caption{List of defined working points with fixed true \tauhadvis
    selection efficiencies and the corresponding background rejection
    factors for misidentified \tauhadvis in dijet events for the BDT
    and RNN classifiers. Adapted from~\cite{ATL-PHYS-PUB-2019-033}.}%
  \label{tab:rnn_wps}

  \begin{tabular}{lcccccc}
    \toprule
                  & \multicolumn{2}{c}{Signal efficiency} & \multicolumn{2}{c}{Background rejection (BDT)} & \multicolumn{2}{c}{Background rejection (RNN)} \\
    Working point  & 1-prong & 3-prong & 1-prong & 3-prong & 1-prong & 3-prong \\
    \midrule
    Tight          & 60\%    & 45\%    & 40      & 400  & 70   & 700 \\
    Medium         & 75\%    & 60\%    & 20      & 150  & 35   & 240 \\
    Loose          & 85\%    & 75\%    & 12      & 61   & 21   & 90  \\
    Very loose     & 95\%    & 95\%    & 5.3     & 11.2 & 9.9  & 16  \\
    \bottomrule
  \end{tabular}
\end{table}

\subsection{Use at the HLT?}

\cite{ATL-DAQ-PUB-2019-001}


\section{Conclusion and Outlook}
\label{sec:tauid_conclusion}


To be replaced by ``deep sets'' (permutation invariance). Based on the
same idea and same expected performance but significantly improved
training and prediction time.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../phd_thesis"
%%% End:
